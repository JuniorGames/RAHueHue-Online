<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8"/>
    <link href="docs/favicon.ico" rel="icon" type="image/x-icon"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>RetroGames HueHue</title>
    <style>
        /* Estilos gerais */
        body, html {
            height: 100%;
            background: url('docs/bg_hue.png') no-repeat center center fixed;
            background-size: cover;
            color: yellow;
            margin: 0;
            overflow: hidden;
            position: relative;
            font-family: 'Courier New', monospace;
        }

        body, #box, #top {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        /* Melhorias de legibilidade - contorno preto em todos os textos */
        body, button, select, input, div, span {
            text-shadow: 
                0.5px 0.5px 0 #000, 
                -0.5px -0.5px 0 #000, 
                0.5px -0.5px 0 #000, 
                -0.5px 0.5px 0 #000,
                0 0 2px #000;
        }

        /* Estilos da caixa principal */
        #box {
            color: #fff;
            height: 26em;
            width: 15em;
            max-width: 80%;
            max-height: 80%;
            background-color: #333;
            border-radius: 0.4em;
            border: 2px solid #555;
            position: relative;
            transition: border-color 0.2s, color 0.2s, height 0.5s, width 0.5s;
            overflow: hidden;
            font-weight: bold;
            font-size: 20px;
            margin: 5px;
            padding: 1em;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
            z-index: 10;
        }

        #box.fullscreen {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            max-width: 100% !important;
            max-height: 100% !important;
            margin: 0 !important;
            padding: 0 !important;
            border-radius: 0 !important;
            border: none !important;
            z-index: 9999 !important;
        }

        #box:hover, #box[drag] {
            border-color: #38f;
            color: #ddd;
        }

        /* Estilos para bot√µes e sele√ß√£o */
        select, button, input[type="text"] {
            padding: 1.0em 0.8em;
            margin: 0.4em;
            width: 14em;
            max-width: 100%;
            font-weight: bold;
            font-size: 15px;
            background-color: #4CAF50;
            color: white;
            border: 2px solid white;
            border-radius: 0.4em;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            text-shadow: 
                0.7px 0.7px 0 #000, 
                -0.7px -0.7px 0 #000, 
                0.7px -0.7px 0 #000, 
                -0.7px 0.7px 0 #000,
                0 0 3px #000;
            font-weight: 800;
            box-sizing: border-box;
        }

        /* Destaque especial para lista de consoles em PC/Xbox */
        @media not all and (max-width: 768px) {
            select option {
                text-shadow: 
                    0.7px 0.7px 0 #000, 
                    -0.7px -0.7px 0 #000, 
                    0.7px -0.7px 0 #000, 
                    -0.7px 0.7px 0 #000,
                    0 0 3px #000;
                font-weight: 800;
                background-color: #333;
                color: white;
            }
        }

        select:hover, button:hover, input[type="text"]:hover {
            background-color: #45a049;
            box-shadow: 0 0 10px 5px rgba(255, 255, 255, 0.6);
            transform: scale(1.02);
        }

        select:focus, button:focus, input[type="text"]:focus {
            outline: none;
            box-shadow: 0 0 10px 5px rgba(76, 175, 80, 0.8);
        }

        select {
            color: white;
            border: 1px solid white;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.7em top 50%;
            background-size: 1.5em auto;
        }

        /* Estilos para √≠cones e logo */
        .logo {
            width: 130px;
            height: 130px;
            filter: drop-shadow(0 0 10px white);
            transition: transform 0.3s;
            animation: floatLogo 4s ease-in-out infinite;
            position: relative;
            z-index: 5;
        }

        @keyframes floatLogo {
            0% { transform: translateY(5px); }
            50% { transform: translateY(150px); }
            100% { transform: translateY(5px); }
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .icon-left, .icon-right {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1000;
            max-width: 35%;
            height: auto;
            filter: drop-shadow(0 0 10px white) brightness(1.2);
            animation: float 6s ease-in-out infinite;
        }

        .icon-left {
            left: 10px;
            animation-delay: 0s;
        }

        .icon-right {
            right: 10px;
            animation-delay: 1s;
        }

        @keyframes float {
            0% { transform: translateY(-50%) translateY(0px); }
            50% { transform: translateY(-50%) translateY(-20px); }
            100% { transform: translateY(-50%) translateY(0px); }
        }

        /* Estilos para √≠cones de consoles */
        #consoleIcon {
            width: 120px;
            height: 90px;
            display: inline-block;
            margin-right: 10px;
            transition: transform 0.3s;
        }

        #consoleIcon:hover {
            transform: scale(1.05);
        }

        /* Estilos para bot√µes personalizados */
        .custom-button {
            background-color: #4CAF50;
            color: white;
            border: 2px solid white;
            font-weight: bold;
        }

        .custom-button:hover {
            background-color: #45a049;
        }

        /* Estilos para entrada de URL da ROM */
        #romUrl {
            padding: 1.0em 0.8em;
            text-shadow: 
                0.7px 0.7px 0 #000, 
                -0.7px -0.7px 0 #000, 
                0.7px -0.7px 0 #000, 
                -0.7px 0.7px 0 #000,
                0 0 3px #000;
            font-weight: 800;
        }

        /* Corre√ß√£o para cor do texto no autocomplete */
        #romUrl:-webkit-autofill,
        #romUrl:-webkit-autofill:hover, 
        #romUrl:-webkit-autofill:focus, 
        #romUrl:-webkit-autofill:active {
            -webkit-text-fill-color: white !important;
            -webkit-box-shadow: 0 0 0px 1000px #4CAF50 inset !important;
            background-color: #4CAF50 !important;
            color: white !important;
            text-shadow: 
                0.7px 0.7px 0 #000, 
                -0.7px -0.7px 0 #000, 
                0.7px -0.7px 0 #000, 
                -0.7px 0.7px 0 #000,
                0 0 3px #000 !important;
            font-weight: 800 !important;
        }

        #romUrl::placeholder {
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 
                0.5px 0.5px 0 #000, 
                -0.5px -0.5px 0 #000, 
                0.5px -0.5px 0 #000, 
                -0.5px 0.5px 0 #000,
                0 0 2px #000;
        }

        /* Media query para mobile */
        @media (max-width: 768px), (max-height: 768px) and (orientation: portrait) {
            .icon-left, .icon-right {
                display: none;
            }
            
            #box {
                max-width: 95%; 
                max-height: 95%; 
                width: 15em; 
                height: 26em; 
                padding: 1em; 
            }
            
            .custom-button, select, #romUrl {
                font-size: 15px; 
                padding: 1.0em 0.8em; 
                width: 14em; 
            }
            
            /* Ajuste para bot√£o SAIR em dispositivos m√≥veis */
            #exit-btn {
                top: auto !important;
                bottom: 20px !important;
                left: 50% !important;
                right: auto !important;
                transform: translateX(-50%) !important;
                z-index: 10001 !important;
                width: auto; 
                max-width: 120px; /* Largura reduzida para n√£o interferir na gameplay */
                text-align: center;
                font-size: 16px;
                padding: 0.5em 1em;
                position: absolute;
                background-color: #4CAF50; /* Cor dos bot√µes principais */
            }
            
            /* Contador de tempo na parte superior em dispositivos m√≥veis */
            #playtime-container {
                top: 20px !important;
                bottom: auto !important;
                left: 50% !important;
                right: auto !important;
                transform: translateX(-50%) !important;
                z-index: 10001 !important;
                width: auto;
                text-align: center;
                position: absolute;
            }
            
            #consoleIcon {
                width: 120px;
                height: 90px;
            }
            
            .logo {
                width: 130px;
                height: 130px;
            }

            .button-container > * {
                width: 100% !important;
                max-width: 14em;
                margin: 0.4em auto;
            }
            
            /* Ajuste especial para tela de jogo em mobile */
            #display {
                width: 100% !important;
                height: auto !important;
                max-height: calc(100% - 100px) !important;
                object-fit: contain;
                position: relative;
                top: 0;
                left: 0;
            }
        }

        /* Estilos para exibi√ß√£o de miniaturas de jogos */
        #gameThumbnail {
            position: fixed;
            bottom: 10px;
            right: 10px;
            width: 150px;
            height: 150px;
            border: 2px solid white;
            border-radius: 0.4em;
            background-color: #333;
            display: none;
            box-shadow: 0 0 15px rgba(0,0,0,0.7);
            z-index: 1001;
        }

        #gameThumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 0.4em;
        }

        /* Ajuste para o layout dos bot√µes */
        .button-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        .button-container button, .button-container select, .button-container input[type="text"] {
            width: 14em;
            margin: 0.3em 0;
        }

        /* Estilo para a mensagem de erro */
        #error-message {
            color: #ffdddd;
            font-weight: bold;
            display: none;
            text-align: center;
            padding: 0.8em;
            background-color: rgba(150, 0, 0, 0.7);
            border-radius: 0.4em;
            width: 100%;
            text-shadow: 0 0 4px #000;
            border: 1px solid #ff5555;
            font-size: 16px;
        }

        /* Estilo do display do jogo - IMPORTANTE: Manter propor√ß√£o original */
        #display {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            object-fit: contain;
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #display canvas {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .dual-buttons {
            display: flex;
            justify-content: space-between;
            width: 14em;
            max-width: 100%;
            margin: 0.5em 0;
        }

        .dual-buttons button {
            width: 6.8em;
            padding: 0.5em 0.1em;
            font-size: 12px;
            flex: 1;
            margin: 0 0.2em;
        }

        /* Bot√£o de sa√≠da - ATUALIZA√á√ïES SOLICITADAS */
        #exit-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10000;
            /* Alterado para mesma cor dos bot√µes principais */
            background-color: #4CAF50;
            color: white;
            border: 2px solid white;
            border-radius: 0.4em;
            padding: 0.5em 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            text-shadow: 
                0.7px 0.7px 0 #000, 
                -0.7px -0.7px 0 #000, 
                0.7px -0.7px 0 #000, 
                -0.7px 0.7px 0 #000,
                0 0 3px #000;
            font-weight: 800;
            font-size: 16px;
            /* Largura reduzida para PC/Xbox */
            max-width: 120px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Ajuste de largura para dispositivos n√£o m√≥veis */
        @media not all and (max-width: 768px) {
            #exit-btn {
                max-width: 120px;
            }
        }

        #exit-btn:hover {
            background-color: #45a049;
            box-shadow: 0 0 15px 5px rgba(76, 175, 80, 0.6);
            transform: scale(1.05);
        }

        /* Contador de tempo de jogo - ATUALIZADO COM LEGENDA */
        #playtime-container {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 10000;
            background-color: rgba(0, 0, 0, 0.7);
            color: #ffcc00;
            padding: 0.5em 1em;
            border-radius: 0.4em;
            font-weight: bold;
            border: 1px solid #ffcc00;
            text-align: center;
            min-width: 100px;
        }

        #playtime {
            font-size: 16px;
            text-shadow: 
                0.5px 0.5px 0 #000, 
                -0.5px -0.5px 0 #000, 
                0.5px -0.5px 0 #000, 
                -0.5px 0.5px 0 #000,
                0 0 2px #000;
            font-weight: 800;
        }

        #playtime-caption {
            font-size: 12px;
            color: #ffcc00;
            margin-top: 4px;
            text-shadow: 
                0.5px 0.5px 0 #000, 
                -0.5px -0.5px 0 #000, 
                0.5px -0.5px 0 #000, 
                -0.5px 0.5px 0 #000,
                0 0 2px #000;
        }

        /* Controles touch */
        #touch-controls {
            position: absolute;
            bottom: 20px;
            width: 100%;
            display: flex;
            justify-content: space-around;
            z-index: 1000;
            padding: 0 10px;
            box-sizing: border-box;
        }

        .touch-btn {
            font-size: 24px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: rgba(76, 175, 80, 0.7);
            color: white;
            border: 2px solid white;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
            touch-action: manipulation;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            transition: all 0.1s;
            text-shadow: 
                0.7px 0.7px 0 #000, 
                -0.7px -0.7px 0 #000, 
                0.7px -0.7px 0 #000, 
                -0.7px 0.7px 0 #000,
                0 0 3px #000;
            font-weight: 800;
        }

        .touch-btn:active {
            background-color: rgba(69, 160, 73, 0.9);
            transform: scale(0.95);
        }

        /* Mensagem de carregamento */
        .loading-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 24px;
            text-align: center;
            z-index: 100;
            text-shadow: 0 0 5px #000;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 1em 2em;
            border-radius: 0.5em;
            animation: pulse 1.5s infinite;
            text-shadow: 
                1px 1px 0 #000, 
                -1px -1px 0 #000, 
                1px -1px 0 #000, 
                -1px 1px 0 #000,
                0 0 5px #000;
            font-weight: 800;
        }

        @keyframes pulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }

        /* Notifica√ß√£o */
        #notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.85);
            color: #ffcc00;
            padding: 12px 24px;
            border-radius: 8px;
            z-index: 10000;
            display: none;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 0 15px rgba(0,0,0,0.7);
            border: 1px solid #ffcc00;
            font-size: 18px;
            text-shadow: 
                0.7px 0.7px 0 #000, 
                -0.7px -0.7px 0 #000, 
                0.7px -0.7px 0 #000, 
                -0.7px 0.7px 0 #000,
                0 0 3px #000;
            font-weight: 800;
        }

        /* Feedback para controles */
        .control-feedback {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.85);
            color: yellow;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            display: none;
            z-index: 1000;
            text-shadow: 
                0.7px 0.7px 0 #000, 
                -0.7px -0.7px 0 #000, 
                0.7px -0.7px 0 #000, 
                -0.7px 0.7px 0 #000,
                0 0 3px #000;
            font-weight: 800;
            border: 1px solid yellow;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <!-- √çcones e logo -->
    <img alt="Icon Left" class="icon-left" src="docs/huehue.png"/>
    <img alt="Icon Right" class="icon-right" src="docs/hue.png"/>
    
    <!-- Cabe√ßalho -->
    <header id="top">
        <img alt="Logo" class="logo" src="docs/Logo-light.png"/>
    </header>
    
    <!-- Caixa principal -->
    <main id="box">
        <div id="consoleIconContainer">
            <img alt="√çcone do Console" id="consoleIcon" src="icons/rahue.png"/>
        </div>
        <div class="button-container">
            <select id="selectCore">
                <option disabled hidden selected value="">üëÄEscolher ConsoleüëÄ</option>
                <!-- Op√ß√µes de consoles -->
                <option data-icon="icons/fbneo.png" value="fbneo">Arcades FBNeo</option>
                <option data-icon="icons/mame.png" value="mame2003_plus">Arcades MAME</option>
                <option data-icon="icons/atari2600.png" value="atari2600">Atari 2600</option>
                <option data-icon="icons/atari7800.png" value="atari7800">Atari 7800</option>
                <option data-icon="icons/lynx.png" value="lynx">Atari Lynx</option>
                <option data-icon="icons/jaguar.png" value="jaguar">Atari Jaguar</option>
                <option data-icon="icons/ws.png" value="ws">WonderSwan</option>
                <option data-icon="icons/wsc.png" value="ws">WonderSwan Color</option>
                <option data-icon="icons/coleco.png" value="coleco">ColecoVision</option>
                <option data-icon="icons/vice_x64sc.png" value="vice_x64sc">Commodore 64</option>
                <option data-icon="icons/vice_x128.png" value="vice_x128">Commodore 128</option>
                <option data-icon="icons/vice_xvic.png" value="vice_xvic">Commodore VIC20</option>
                <option data-icon="icons/vice_xplus4.png" value="vice_xplus4">Commodore Plus/4</option>
                <option data-icon="icons/vice_xpet.png" value="vice_xpet">Commodore PET</option>
                <option data-icon="icons/n64.png" value="n64">Nintendo 64</option>
                <option data-icon="icons/nds.png" value="nds">Nintendo DS</option>
                <option data-icon="icons/gb.png" value="gb">Game Boy</option>
                <option data-icon="icons/gba.png" value="gba">Game Boy Advance</option>
                <option data-icon="icons/gbc.png" value="gbc">Game Boy Color</option>
                <option data-icon="icons/nes.png" value="nes">Nintendo</option>
                <option data-icon="icons/snes.png" value="snes">Super Nintendo</option>
                <option data-icon="icons/vb.png" value="vb">Virtual Boy</option>
                <option data-icon="icons/pce.png" value="pce">TurboGrafx-16</option>
                <option data-icon="icons/pcen.png" value="pce">PC Engine</option>
                <option data-icon="icons/pces.png" value="pce">SuperGrafx</option>
                <option data-icon="icons/segaGG.png" value="segaGG">Game Gear</option>
                <option data-icon="icons/segaMD.png" value="segaMD">Mega Drive</option>
                <option data-icon="icons/sega32x.png" value="sega32x">Sega 32X</option>
                <option data-icon="icons/segaSaturn.png" value="segaSaturn">Saturn</option>
                <option data-icon="icons/segaMS.png" value="segaMS">Master System</option>
                <option data-icon="icons/segaSG100.png" value="segaMD">SG-1000</option>
                <option data-icon="icons/ngp.png" value="ngp">NeoGeo Pocket</option>
                <option data-icon="icons/ngpc.png" value="ngp">NeoGeo Pocket Color</option>
                <option data-icon="icons/psx.png" value="psx">PlayStation</option>
            </select>
            <button class="custom-button" id="loadLocalBtn" onclick="openFile()">üìÅCarregar ROMüìÅ</button>
            <input id="romUrl" placeholder="‚õîLink URL da ROM‚õî" type="text"/>
            <button class="custom-button" onclick="loadRom()">üî•Iniciar Jogoüî•</button>
            <button class="custom-button" id="raHueHueOnlineBtn" onclick="openRAHueHueOnline()">üåéRAHueHue Onlineüåé</button>
            <button class="custom-button" id="webHueHueBtn" onclick="openWebHueHue()">üéÆWEBHueHueüéÆ</button>
            <div class="dual-buttons">
                <button class="custom-button" onclick="window.open('https://www.youtube.com/shorts/1GYQdSiKdXs', '_blank')">üì± Android</button>
                <button class="custom-button" onclick="window.open('https://youtu.be/XLeFLg6SOuA?list=PLGlR7kZN64OgNBoSEZhOeUKn84XUY8qbd&amp;t=3032', '_blank')">üì∫ Xbox</button>
            </div>
            <div id="error-message">Link URL ou Carregar ROM</div>
        </div>
    </main>
    
    <!-- Miniatura do jogo -->
    <div id="gameThumbnail">
        <img alt="Miniatura do Jogo" id="gameThumbnailImage" src=""/>
    </div>
    
    <!-- Notifica√ß√£o -->
    <div id="notification"></div>
    
    <!-- Feedback para controles -->
    <div id="controlFeedback" class="control-feedback"></div>
    
    <!-- Scripts -->
    <script>
        // =============================================
        // CONTROLES XBOX PARA NAVEGA√á√ÉO (ATUALIZADO)
        // =============================================
        // Vari√°veis para controle do gamepad
        let selectPressed = false;
        let startPressed = false;
        let comboPressTimer = null;
        let selectHoldTimer = null;
        let gamepad = null;
        let gamepadMonitorRunning = false;
        let playtimeInterval = null;
        let playtimeSeconds = 0;

        // Fun√ß√£o para mostrar feedback visual dos controles
        function showControlFeedback(message) {
            const feedbackElement = document.getElementById('controlFeedback');
            feedbackElement.textContent = message;
            feedbackElement.style.display = 'block';
            setTimeout(() => {
                feedbackElement.style.display = 'none';
            }, 2000);
        }

        // Fun√ß√£o para alternar fullscreen
        function toggleGameFullscreen() {
            const display = document.getElementById('display');
            if (!display) return;
            
            if (document.fullscreenElement === display) {
                document.exitFullscreen()
                    .then(() => showControlFeedback("TELA CHEIA DESATIVADA"))
                    .catch(err => console.error("Erro ao sair do fullscreen:", err));
            } else {
                display.requestFullscreen()
                    .then(() => {
                        showControlFeedback("TELA CHEIA ATIVADA");
                        // For√ßar propor√ß√£o correta ap√≥s entrar em fullscreen
                        setTimeout(adjustDisplaySize, 100);
                    })
                    .catch(err => console.error("Erro ao entrar em fullscreen:", err));
            }
        }

        // Fun√ß√£o para ativar modo de navega√ß√£o
        function activateNavigationMode() {
            // Focar no bot√£o de sa√≠da para permitir navega√ß√£o com controle
            const exitBtn = document.getElementById('exit-btn');
            if (exitBtn) {
                exitBtn.focus();
                showControlFeedback("MODO NAVEGA√á√ÉO ATIVADO");
            }
        }

        // Monitoramento do gamepad
        function monitorGamepad() {
            if (!gamepadMonitorRunning) return;
            
            const gamepads = navigator.getGamepads();
            if (!gamepads[0]) {
                requestAnimationFrame(monitorGamepad);
                return;
            }
            
            gamepad = gamepads[0];
            
            // Bot√£o 8 = SELECT/VIEW, Bot√£o 9 = START/OPTIONS
            selectPressed = gamepad.buttons[8]?.pressed || false;
            startPressed = gamepad.buttons[9]?.pressed || false;
            
            // Segurar SELECT por 3 segundos (Fullscreen)
            if (selectPressed && !startPressed) {
                if (!selectHoldTimer) {
                    selectHoldTimer = setTimeout(() => {
                        toggleGameFullscreen();
                        selectHoldTimer = null;
                    }, 3000);
                }
            } else if (selectHoldTimer) {
                clearTimeout(selectHoldTimer);
                selectHoldTimer = null;
            }
            
            // Segurar SELECT + START por 1 segundo (Ativar modo navega√ß√£o)
            if (selectPressed && startPressed) {
                if (!comboPressTimer) {
                    comboPressTimer = setTimeout(() => {
                        activateNavigationMode();
                        comboPressTimer = null;
                    }, 1000);
                }
            } else if (comboPressTimer) {
                clearTimeout(comboPressTimer);
                comboPressTimer = null;
            }
            
            requestAnimationFrame(monitorGamepad);
        }

        // Iniciar monitoramento quando um controle √© conectado
        window.addEventListener("gamepadconnected", (e) => {
            gamepad = e.gamepad;
            console.log("Controle conectado:", gamepad.id);
            showControlFeedback('CONTROLE CONECTADO');
            
            if (!gamepadMonitorRunning) {
                gamepadMonitorRunning = true;
                monitorGamepad();
            }
        });

        window.addEventListener("gamepaddisconnected", (e) => {
            console.log("Controle desconectado:", e.gamepad.id);
            gamepad = null;
            showControlFeedback('CONTROLE DESCONECTADO');
        });

        // =============================================
        // C√ìDIGO PRINCIPAL DO EMULADOR
        // =============================================
        // Configura√ß√£o inicial
        let enableDebug = false;
        let isGameActive = false;
        let originalContent = null;

        // Verificar modo de depura√ß√£o
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        if (urlParams.get('debug') === '1') {
            enableDebug = true;
        }

        // Fun√ß√µes de detec√ß√£o de dispositivo
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        function isXboxEdge() {
            return navigator.userAgent.includes('Xbox') && navigator.userAgent.includes('Edge');
        }

        // Elementos DOM
        const selectCore = document.getElementById('selectCore');
        const romUrlInput = document.getElementById('romUrl');
        const fileInput = document.createElement('input');
        fileInput.type = 'file';
        fileInput.style.display = 'none';
        document.body.appendChild(fileInput);

        const loadLocalBtn = document.getElementById('loadLocalBtn');
        const raHueHueOnlineBtn = document.getElementById('raHueHueOnlineBtn');
        const webHueHueBtn = document.getElementById('webHueHueBtn');
        const consoleIcon = document.getElementById('consoleIcon');
        const gameThumbnail = document.getElementById('gameThumbnail');
        const gameThumbnailImage = document.getElementById('gameThumbnailImage');
        const errorMessage = document.getElementById('error-message');
        const box = document.getElementById('box');
        const notification = document.getElementById('notification');

        // Mostrar notifica√ß√£o
        function showNotification(message) {
            notification.textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // Fun√ß√£o para ajustar o tamanho do display
        function adjustDisplaySize() {
            const display = document.getElementById('display');
            if (!display) return;
            
            // Obter propor√ß√£o original 4:3
            const aspectRatio = 4/3;
            const containerWidth = display.clientWidth;
            const containerHeight = display.clientHeight;
            
            let newWidth, newHeight;
            
            if (containerWidth / containerHeight > aspectRatio) {
                // Container √© mais largo que a propor√ß√£o
                newHeight = containerHeight;
                newWidth = containerHeight * aspectRatio;
            } else {
                // Container √© mais alto que a propor√ß√£o
                newWidth = containerWidth;
                newHeight = containerWidth / aspectRatio;
            }
            
            // Aplicar dimens√µes calculadas
            display.style.width = newWidth + 'px';
            display.style.height = newHeight + 'px';
            display.style.position = 'absolute';
            display.style.top = '50%';
            display.style.left = '50%';
            display.style.transform = 'translate(-50%, -50%)';
        }

        // Iniciar contador de tempo de jogo
        function startPlaytimeCounter() {
            const playtimeElement = document.getElementById('playtime');
            if (!playtimeElement) return;
            
            playtimeSeconds = 0;
            
            if (playtimeInterval) {
                clearInterval(playtimeInterval);
            }
            
            playtimeInterval = setInterval(() => {
                playtimeSeconds++;
                const hours = Math.floor(playtimeSeconds / 3600);
                const minutes = Math.floor((playtimeSeconds % 3600) / 60);
                const seconds = playtimeSeconds % 60;
                
                playtimeElement.textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        // Parar contador de tempo de jogo
        function stopPlaytimeCounter() {
            if (playtimeInterval) {
                clearInterval(playtimeInterval);
                playtimeInterval = null;
            }
        }

        // Pr√©-carregar assets importantes
        function preloadAssets() {
            const assets = [
                'docs/huehue.png',
                'docs/hue.png',
                'docs/Logo-light.png',
                'icons/rahue.png',
                'data/loader.js'
            ];
            
            assets.forEach(asset => {
                const link = document.createElement('link');
                link.rel = 'preload';
                link.href = asset;
                link.as = asset.endsWith('.js') ? 'script' : 'image';
                document.head.appendChild(link);
            });
        }
        
        window.addEventListener('DOMContentLoaded', preloadAssets);

        // Ordenar op√ß√µes do select
        const optionsArray = Array.from(selectCore.options);
        optionsArray.sort((a, b) => a.text.localeCompare(b.text));
        selectCore.innerHTML = "";
        optionsArray.forEach(option => selectCore.appendChild(option));

        // Atualizar √≠cone do console selecionado
        selectCore.addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            const iconUrl = selectedOption.getAttribute('data-icon');
            if (iconUrl) {
                consoleIcon.src = iconUrl;
            }
        });

        // Fun√ß√£o principal para carregar ROM
        function loadRom() {
            const romUrl = romUrlInput.value;
            const core = selectCore.value;

            if (core === "") {
                showNotification("Selecione um console primeiro!");
                return;
            }

            if (romUrl) {
                loadGameFromUrl(romUrl, core);
            } else if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                loadGameFromFile(file, core);
            } else {
                errorMessage.style.display = 'block';
                setTimeout(() => {
                    errorMessage.style.display = 'none';
                }, 3000);
            }
        }

        // Carregar jogo da URL
        function loadGameFromUrl(romUrl, core) {
            // Salvar conte√∫do original para restaurar depois
            if (!originalContent) {
                originalContent = box.innerHTML;
            }
            
            errorMessage.style.display = 'none';
            isGameActive = true;

            const div = document.createElement("div");
            div.id = "display";
            box.innerHTML = "";
            box.appendChild(div);

            // Adicionar mensagem de carregamento
            const loadingMsg = document.createElement('div');
            loadingMsg.className = 'loading-message';
            loadingMsg.textContent = 'CARREGANDO...';
            div.appendChild(loadingMsg);

            // Configurar o emulador
            window.EJS_player = "#display";
            window.EJS_gameName = "ROM Carregada";
            window.EJS_biosUrl = "";
            window.EJS_gameUrl = romUrl;
            window.EJS_core = core;
            window.EJS_pathtodata = "data/";
            window.EJS_startOnLoaded = true;
            window.EJS_DEBUG_XX = enableDebug;
            window.EJS_disableDatabases = true;

            // Adicionar bot√£o de sa√≠da
            addExitButton();
            
            // Adicionar contador de tempo
            addPlaytimeCounter();
            
            // Iniciar contador
            startPlaytimeCounter();
            
            // Adicionar controles touch para dispositivos m√≥veis
            if (isMobileDevice()) {
                addTouchControls();
            }
            
            // Bloquear orienta√ß√£o para dispositivos m√≥veis
            lockScreenOrientation();

            // Carregar o script do emulador
            const script = document.createElement("script");
            script.src = "data/loader.js";
            
            // Adicionar fallback caso o CDN principal falhe
            script.onerror = () => {
                const fallbackScript = document.createElement('script');
                fallbackScript.src = 'data/loader.js';
                document.body.appendChild(fallbackScript);
                console.log("Usando CDN alternativo para o emulador");
            };
            
            script.onload = () => {
                // Remover mensagem de carregamento
                if (loadingMsg.parentNode) {
                    loadingMsg.parentNode.removeChild(loadingMsg);
                }
                
                // Ajustar tamanho do display ap√≥s carregar
                setTimeout(() => {
                    adjustDisplaySize();
                    
                    // Adicionar listener para redimensionamento
                    window.addEventListener('resize', adjustDisplaySize);
                }, 500);
                
                // Ativar fullscreen autom√°tico em Android
                if (isMobileDevice()) {
                    setTimeout(() => {
                        const display = document.getElementById('display');
                        if (display && display.requestFullscreen) {
                            display.requestFullscreen().catch(e => console.log(e));
                            showNotification("Modo Tela Cheia Ativado");
                        }
                    }, 1000);
                }
                
                // Iniciar monitoramento do gamepad
                gamepadMonitorRunning = true;
                monitorGamepad();
            };
            
            document.body.appendChild(script);

            hideIconsAndHeader();
            expandBox();
            displayGameThumbnail(romUrl);
            
            // Mostrar notifica√ß√£o
            showNotification("Jogo carregado! Aproveite!");
        }

        // Adicionar contador de tempo de jogo com legenda
        function addPlaytimeCounter() {
            if (document.getElementById('playtime-container')) return;
            
            const container = document.createElement('div');
            container.id = 'playtime-container';
            container.style.position = 'absolute';
            container.style.top = '10px';
            container.style.left = '10px';
            container.style.zIndex = '10000';
            container.style.textAlign = 'center';
            
            const playtimeElement = document.createElement('div');
            playtimeElement.id = 'playtime';
            playtimeElement.textContent = '00:00:00';
            playtimeElement.style.fontSize = '16px';
            playtimeElement.style.fontWeight = 'bold';
            playtimeElement.style.color = '#ffcc00';
            playtimeElement.style.textShadow = '0.5px 0.5px 0 #000, -0.5px -0.5px 0 #000, 0.5px -0.5px 0 #000, -0.5px 0.5px 0 #000, 0 0 2px #000';
            
            const caption = document.createElement('div');
            caption.id = 'playtime-caption';
            caption.textContent = 'Tempo jogado';
            caption.style.fontSize = '12px';
            caption.style.color = '#ffcc00';
            caption.style.textShadow = '0.5px 0.5px 0 #000, -0.5px -0.5px 0 #000, 0.5px -0.5px 0 #000, -0.5px 0.5px 0 #000, 0 0 2px #000';
            caption.style.marginTop = '4px';
            
            container.appendChild(playtimeElement);
            container.appendChild(caption);
            box.appendChild(container);
        }

        // Adicionar controles touch para dispositivos m√≥veis
        function addTouchControls() {
            if (!isMobileDevice() || document.getElementById('touch-controls')) return;
            
            const controls = document.createElement('div');
            controls.id = 'touch-controls';
            
            const buttons = [
                { symbol: '‚¨ÖÔ∏è', id: 'left-btn' },
                { symbol: '‚û°Ô∏è', id: 'right-btn' },
                { symbol: 'üÖ∞', id: 'a-btn' },
                { symbol: 'üÖ±', id: 'b-btn' }
            ];
            
            buttons.forEach(btn => {
                const button = document.createElement('div');
                button.className = 'touch-btn';
                button.id = btn.id;
                button.textContent = btn.symbol;
                controls.appendChild(button);
            });
            
            document.getElementById('display').appendChild(controls);
        }

        // Bloquear orienta√ß√£o da tela para paisagem
        function lockScreenOrientation() {
            if (!isMobileDevice()) return;
            
            try {
                if (screen.orientation && screen.orientation.lock) {
                    screen.orientation.lock('landscape')
                        .catch(() => console.log("Bloqueio de orienta√ß√£o n√£o suportado"));
                }
            } catch (e) {
                console.error("Erro ao bloquear orienta√ß√£o:", e);
            }
        }

        // Liberar orienta√ß√£o da tela
        function unlockScreenOrientation() {
            try {
                if (screen.orientation && screen.orientation.unlock) {
                    screen.orientation.unlock();
                }
            } catch (e) {
                console.error("Erro ao desbloquear orienta√ß√£o:", e);
            }
        }

        // Adicionar bot√£o de sa√≠da
        function addExitButton() {
            if (document.getElementById('exit-btn')) return;
            
            const exitBtn = document.createElement('button');
            exitBtn.id = 'exit-btn';
            exitBtn.textContent = 'SAIR';
            exitBtn.onclick = exitGame;
            exitBtn.tabIndex = 1; // Permitir foco para navega√ß√£o
            
            box.appendChild(exitBtn);
        }

        // Sair do jogo e voltar ao menu
        function exitGame() {
            // Tentar sair do modo de tela cheia
            if (document.fullscreenElement) {
                document.exitFullscreen().catch(e => console.log(e));
            }
            
            // Liberar orienta√ß√£o da tela
            unlockScreenOrientation();
            
            // Parar monitoramento do gamepad
            gamepadMonitorRunning = false;
            
            // Parar contador de tempo
            stopPlaytimeCounter();
            
            // Remover listener de redimensionamento
            window.removeEventListener('resize', adjustDisplaySize);
            
            // Recarregar a p√°gina para garantir que tudo seja reiniciado
            location.reload();
        }

        // Carregar jogo local
        function loadGameFromFile(file, core) {
            const reader = new FileReader();
            reader.onload = function(event) {
                const romUrl = event.target.result;
                loadGameFromUrl(romUrl, core);
            };
            reader.readAsDataURL(file);
        }

        // Exibir miniatura
        function displayGameThumbnail(romUrl) {
            const image = new Image();
            image.src = romUrl;
            image.onload = function() {
                gameThumbnailImage.src = image.src;
                gameThumbnail.style.display = 'block';
            };
            image.onerror = function() {
                gameThumbnail.style.display = 'none';
            };
        }

        // Fun√ß√µes auxiliares
        function openFile() {
            fileInput.click();
        }

        function openRAHueHueOnline() {
            window.location.href = 'lists/RAHueHue Online.html';
        }

        function openWebHueHue() {
            window.open('https://play.webrcade.com/?feed=https://tinyurl.com/retrohue', '_blank');
        }

        // Event listeners
        fileInput.addEventListener('change', () => {
            if (fileInput.files.length > 0) {
                loadLocalBtn.textContent = fileInput.files[0].name;
                showNotification("ROM selecionada! Clique em Iniciar Jogo");
            } else {
                loadLocalBtn.textContent = 'üìÅCarregar ROMüìÅ';
            }
        });

        // Controle de layout
        function hideIconsAndHeader() {
            const icons = document.querySelectorAll('.icon-left, .icon-right');
            const header = document.getElementById('top');
            icons.forEach(icon => icon.style.display = 'none');
            if (header) header.style.display = 'none';
        }

        function expandBox() {
            if (!isMobileDevice() && !isXboxEdge()) {
                box.style.height = '97em';
                box.style.width = '97em';
                box.style.maxWidth = '97%';
                box.style.maxHeight = '97%';
            }
        }
        
        // Adicionar atalho de teclado (ESC para sair)
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape' && isGameActive) {
                exitGame();
            }
        });
        
        // Inicializa√ß√£o
        window.addEventListener('DOMContentLoaded', function() {
            // Iniciar monitoramento de gamepad se j√° estiver conectado
            const gamepads = navigator.getGamepads();
            if (gamepads[0]) {
                gamepad = gamepads[0];
                gamepadMonitorRunning = true;
                monitorGamepad();
            }
        });
    </script>
</body>
</html>